<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory - Kunash Enterprises Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        .animate-fadeIn { animation: fadeIn .5s ease-out forwards; }
        .stat-card { transition: all .3s ease; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(0,0,0,.1), 0 10px 10px -5px rgba(0,0,0,.04); }
        .progress-bar { height:8px; border-radius:4px; background:#e5e7eb; overflow:hidden; }
        .progress-fill { height:100%; border-radius:4px; background:#ea580c; transition:width .5s ease-in-out; }
        .main-content { transition: margin-left 0.3s ease; }
        .sidebar-collapsed { width: 5rem !important; }
        .sidebar-collapsed .sidebar-logo { width: 3rem !important; height: 3rem !important; }
        .sidebar-collapsed .sidebar-text { display: none; }
        .table-wrapper { overflow-x:auto; }
        .stock-low { background:#fef3c7; }   /* amber-100 */
        .stock-out { background:#fee2e2; }   /* red-100 */
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            border-radius: 8px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .image-preview {
            max-width: 150px;
            max-height: 150px;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .img-thumb { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; }
        .sub-img-preview { width: 50px; height: 50px; object-fit: cover; border-radius: 6px; margin: 4px; border: 1px solid #ccc; position: relative; }
        .remove-img { position: absolute; top: -6px; right: -6px; background: red; color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .dynamic-field { display: none; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
<div class="flex h-screen">
     <!-- Sidebar -->
    <div id="sidebar" class="w-64 bg-gray-800 text-white transition-all duration-300 fixed inset-y-0 left-0 z-20 flex flex-col">
        <div class="p-4 flex items-center justify-between">
            <img src="../assets/images/logoo bg.png" alt="Kunash Logo"
                 class="w-[10rem] h-[4rem] object-contain transition-all duration-300 sidebar-logo">
            <button id="toggle-btn" class="text-white p-1 rounded hover:bg-gray-700">
                <span class="material-icons text-xl">chevron_left</span>
            </button>
        </div>
        <nav class="mt-4 space-y-1 flex-1 px-2">
            <a href="../index.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                <span class="material-icons mr-3">dashboard</span><span class="sidebar-text">Dashboard</span></a>
            <a href="products.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                <span class="material-icons mr-3">inventory_2</span><span class="sidebar-text">Products</span></a>
            <a href="inventory.html" class="flex items-center py-2 px-3 bg-orange-600 font-semibold hover:bg-orange-500 rounded-lg transition">
                <span class="material-icons mr-3">warehouse</span><span class="sidebar-text">Inventory</span></a>
            <a href="orders.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                <span class="material-icons mr-3">shopping_cart</span><span class="sidebar-text">Orders</span></a>
            <a href="customers.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                <span class="material-icons mr-3">people</span><span class="sidebar-text">Customers</span></a>
            <a href="banners.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                <span class="material-icons mr-3">image</span><span class="sidebar-text">Banners</span></a>
            <a href="messages.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                <span class="material-icons mr-3">mail</span><span class="sidebar-text">Messages</span></a>
            <a href="discounts.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                <span class="material-icons mr-3">local_offer</span><span class="sidebar-text">Discount Management</span></a>
            <a href="admins.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                <span class="material-icons mr-3">admin_panel_settings</span><span class="sidebar-text">Admin Management</span></a>
            <a href="../login.html" id="logout-btn" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition mt-4">
                <span class="material-icons mr-3">logout</span><span class="sidebar-text">Logout</span></a>
        </nav>
    </div>
    <!-- =========================================================================== -->

    <!-- ==================== Main Content ==================== -->
    <div class="flex-1 flex flex-col overflow-hidden main-content ml-64 transition-all duration-300">
        <!-- Header -->
        <header class="bg-white shadow-md sticky top-0 z-50">
            <div class="flex justify-between items-center p-4 container mx-auto">
                <!-- Left: Sidebar Toggle + Title -->
                <div class="flex items-center space-x-4">
                    <button id="sidebar-toggle" class="text-gray-600 hover:text-orange-600 focus:outline-none lg:hidden">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                    </button>
                    <h2 class="text-xl font-semibold text-orange-600">Inventory Management</h2>
                </div>

                <!-- Right: Admin Profile Dropdown -->
                <div class="relative">
                    <button id="profile-dropdown-btn"
                        class="flex items-center space-x-3 text-gray-700 hover:text-orange-600 focus:outline-none transition">
                        <div class="text-right hidden sm:block">
                            <p class="text-sm font-medium">Welcome, Admin</p>
                            <p class="text-xs text-gray-500">admin@kunash.com</p>
                        </div>
                        <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-md">
                            A
                        </div>
                        <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>

                    <!-- Dropdown Menu -->
                    <div id="profile-dropdown"
                        class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 hidden z-50 animate-fadeIn">
                        <div class="px-4 py-2 border-b border-gray-100">
                            <p class="text-sm font-semibold text-gray-800">Admin User</p>
                            <p class="text-xs text-gray-500">admin@kunash.com</p>
                        </div>
                        <a href="profile.html" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition">
                            <span class="material-icons text-lg mr-2">person</span>
                            My Profile
                        </a>
                        <!-- <a href="settings.html" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition">
                            <span class="material-icons text-lg mr-2">settings</span>
                            Settings
                        </a> -->
                        <hr class="my-1 border-gray-200">
                        <a href="../login.html"
                            id="logout-btn"
                            class="w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition font-medium">
                            <span class="material-icons text-lg mr-2">logout</span>
                            Logout
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page Body -->
        <main class="flex-1 overflow-y-auto p-6 container mx-auto">
            <!-- Stats -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Stock -->
                <div class="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-orange-500 animate-fadeIn">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-600 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-orange-500" fill="currentColor" viewBox="0 0 20 20"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 5a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V9zm0 5a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"/></svg>
                                Total Stock
                            </h3>
                            <p id="total-stock" class="text-3xl font-bold text-orange-600 mt-2">0</p>
                        </div>
                        <div class="bg-orange-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m8-5V4m0 4a2 2 0 100-4 2 2 0 000 4z"/></svg>
                        </div>
                    </div>
                </div>

                <!-- Low Stock -->
                <div class="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-orange-500 animate-fadeIn">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-600 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-orange-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10 20a10 10 0 110-20 10 10 0 010 20zm-2-5h4a1 1 0 000-2H8a1 1 0 000 2zM6 9h8a1 1 0 000-2H6a1 1 0 000 2zm0 3h8a1 1 0 000-2H6a1 1 0 000 2z"/></svg>
                                Low Stock
                            </h3>
                            <p id="low-stock" class="text-3xl font-bold text-orange-600 mt-2">0</p>
                        </div>
                        <div class="bg-orange-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                        </div>
                    </div>
                </div>

                <!-- Out of Stock -->
                <div class="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-orange-500 animate-fadeIn">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-600 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-orange-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10 20a10 10 0 110-20 10 10 0 010 20zm-2-5h4a1 1 0 000-2H8a1 1 0 000 2zM6 9h8a1 1 0 000-2H6a1 1 0 000 2zm0 3h8a1 1 0 000-2H6a1 1 0 000 2z"/></svg>
                                Out of Stock
                            </h3>
                            <p id="out-stock" class="text-3xl font-bold text-orange-600 mt-2">0</p>
                        </div>
                        <div class="bg-orange-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6m12 0a6 6 0 11-12 0 6 6 0 0112 0z"/></svg>
                        </div>
                    </div>
                </div>

                <!-- Restock Needed -->
                <div class="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-orange-500 animate-fadeIn">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-600 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-orange-500" fill="currentColor" viewBox="0 0 20 20"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 5a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V9zm0 5a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"/></svg>
                                Restock Needed
                            </h3>
                            <p id="restock-needed" class="text-3xl font-bold text-orange-600 mt-2">0</p>
                        </div>
                        <div class="bg-orange-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m-3-9a9 9 0 11-9 9 9 9 0 019-9z"/></svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search & Filters & Add Stock Button -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <input id="search-inventory" type="text" placeholder="Search product…" class="w-full md:w-80 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
                
                <div class="flex gap-3">
                    <select id="filter-category" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <option value="">All Categories</option>
                    </select>
                    
                    <select id="filter-status" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <option value="">All Status</option>
                        <option value="in-stock">In Stock</option>
                        <option value="low-stock">Low Stock</option>
                        <option value="out-of-stock">Out of Stock</option>
                    </select>

                    <button id="add-stock-btn" class="bg-orange-600 hover:bg-orange-500 text-white font-medium py-2 px-6 rounded-lg flex items-center">
                        <span class="material-icons mr-2">add</span> Add Stock
                    </button>
                </div>
            </div>

            <!-- Inventory Table -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden table-wrapper">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subcategory</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">RAM</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current Stock</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-body" class="bg-white divide-y divide-gray-200">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>
</div>

<!-- Add Stock Modal -->
<div id="add-stock-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="p-6 border-b border-gray-200">
            <h3 class="text-xl font-semibold text-orange-600">Add New Stock</h3>
        </div>
        <div class="p-6">
            <form id="add-stock-form" class="space-y-6">
                <!-- Product Name -->
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Product Name <span class="text-red-500">*</span></label>
                    <input type="text" id="product-name" required class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                </div>

                <!-- Category & Subcategory -->
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Category <span class="text-red-500">*</span></label>
                        <select id="product-category" required class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Subcategory</label>
                        <select id="product-subcategory" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            <option value="">Select Subcategory (Optional)</option>
                        </select>
                    </div>
                </div>

                <!-- Quantity & Cost -->
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Quantity <span class="text-red-500">*</span></label>
                        <input type="number" id="product-quantity" required min="0" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Cost (₹) <span class="text-red-500">*</span></label>
                        <input type="number" id="product-cost" required min="0" step="0.01" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    </div>
                </div>

                <!-- Dynamic Fields (RAM) -->
                <div id="ram-field" class="dynamic-field">
                    <label class="block text-gray-700 font-medium mb-1">RAM</label>
                    <select id="product-ram" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        <option value="">Select RAM</option>
                        <option value="4GB">4GB</option>
                        <option value="8GB">8GB</option>
                        <option value="16GB">16GB</option>
                        <option value="32GB">32GB</option>
                    </select>
                </div>

                <!-- Stock Status & Product Status -->
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Stock Status <span class="text-red-500">*</span></label>
                        <select id="product-stock-status" required class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            <option value="in-stock">In Stock</option>
                            <option value="out-of-stock">Out of Stock</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Product Status <span class="text-red-500">*</span></label>
                        <select id="product-status" required class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            <option value="active">Available</option>
                            <option value="discounted">Discounted</option>
                        </select>
                    </div>
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Description</label>
                    <textarea id="product-description" rows="3" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Enter product description..."></textarea>
                </div>

                <!-- Main Image -->
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Main Image <span class="text-red-500">*</span></label>
                    <input type="file" id="main-image" accept="image/*" required class="w-full border p-2 rounded">
                    <div id="main-image-preview" class="mt-2"></div>
                </div>

                <!-- Sub Images -->
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Sub Images (Optional)</label>
                    <input type="file" id="sub-images" accept="image/*" multiple class="w-full border p-2 rounded">
                    <div id="sub-images-preview" class="flex flex-wrap mt-2"></div>
                </div>
            </form>
        </div>
        <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
            <button type="button" id="cancel-add-stock" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition">Cancel</button>
            <button type="button" id="save-new-stock" class="px-4 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded-lg transition">Add Stock</button>
        </div>
    </div>
</div>

<!-- Update Stock Modal -->
<div id="update-stock-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="p-6 border-b border-gray-200">
            <h3 class="text-xl font-semibold text-orange-600" id="update-modal-title">Update Stock</h3>
        </div>
        <div class="p-6">
            <form id="update-stock-form">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Product</label>
                    <p id="update-modal-product-name" class="text-lg font-semibold text-gray-900">-</p>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Current Stock</label>
                    <p id="update-modal-current-stock" class="text-lg text-gray-700">-</p>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="new-stock">New Stock Quantity *</label>
                    <input type="number" id="new-stock" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="stock-action">Action Type</label>
                    <select id="stock-action" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <option value="update">Update Stock</option>
                        <option value="add">Add Stock</option>
                        <option value="remove">Remove Stock</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="stock-reason">Reason (Optional)</label>
                    <textarea id="stock-reason" rows="3" placeholder="Enter reason for stock update..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"></textarea>
                </div>
            </form>
        </div>
        <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
            <button type="button" id="cancel-update-stock" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition">Cancel</button>
            <button type="button" id="save-stock-update" class="px-4 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded-lg transition">Update Stock</button>
        </div>
    </div>
</div>

<!-- ==================== PROFILE SYNC + SIDEBAR JS ==================== -->
<script>
    // === PROFILE SYNC FUNCTION ===
    function updateHeaderProfile() {
        const profile = JSON.parse(localStorage.getItem('adminProfile')) || {
            name: "Admin User", email: "admin@kunash.com", role: "System Administrator", photo: ""
        };

        const avatarContainer = document.querySelector('#profile-dropdown-btn + .relative .w-10.h-10') ||
                                document.querySelector('header .w-10.h-10.bg-orange-500');

        const welcomeNameEl = document.querySelector('header .text-right p.font-medium');
        const welcomeEmailEl = document.querySelector('header .text-right p.text-xs');
        const dropdownName = document.querySelector('#profile-dropdown p.font-semibold');
        const dropdownEmail = document.querySelector('#profile-dropdown p.text-xs');

        if (!avatarContainer) return;

        let img = avatarContainer.querySelector('img');
        let letter = avatarContainer.querySelector('span');

        if (profile.photo) {
            if (!img) {
                img = document.createElement('img');
                img.className = 'w-full h-full rounded-full object-cover';
                img.alt = 'Profile';
                avatarContainer.innerHTML = '';
                avatarContainer.appendChild(img);
            }
            img.src = profile.photo;
        } else {
            if (!letter) {
                letter = document.createElement('span');
                letter.className = 'text-white font-bold text-lg';
                avatarContainer.innerHTML = '';
                avatarContainer.appendChild(letter);
            }
            letter.textContent = profile.name.charAt(0).toUpperCase();
        }

        if (welcomeNameEl) welcomeNameEl.textContent = profile.name;
        if (welcomeEmailEl) welcomeEmailEl.textContent = profile.email;
        if (dropdownName) dropdownName.textContent = profile.name;
        if (dropdownEmail) dropdownEmail.textContent = profile.email;
    }

    // === INITIAL LOAD ===
    document.addEventListener('DOMContentLoaded', () => {
        updateHeaderProfile();

        const dropdownBtn = document.getElementById('profile-dropdown-btn');
        const dropdown = document.getElementById('profile-dropdown');
        if (dropdownBtn && dropdown) {
            dropdownBtn.onclick = () => dropdown.classList.toggle('hidden');
        }
    });

    // === LISTEN FOR UPDATES ===
    window.addEventListener('storage', (e) => {
        if (e.key === 'adminProfile') updateHeaderProfile();
    });
    window.addEventListener('profileUpdated', updateHeaderProfile);

    // === SIDEBAR LOGIC ===
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.querySelector('.main-content');
    const toggleBtn = document.getElementById('toggle-btn');
    const toggleIcon = toggleBtn.querySelector('.material-icons');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    let isCollapsed = false;

    toggleBtn.addEventListener('click', () => {
        isCollapsed = !isCollapsed;
        if (isCollapsed) {
            sidebar.classList.add('sidebar-collapsed');
            mainContent.classList.remove('ml-64');
            mainContent.classList.add('ml-20');
            toggleIcon.textContent = 'chevron_right';
        } else {
            sidebar.classList.remove('sidebar-collapsed');
            mainContent.classList.remove('ml-20');
            mainContent.classList.add('ml-64');
            toggleIcon.textContent = 'chevron_left';
        }
    });

    if (sidebarToggle) {
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });
    }

    document.addEventListener('click', (e) => {
        if (window.innerWidth < 1024) {
            const isClickInside = sidebar.contains(e.target) || (sidebarToggle && sidebarToggle.contains(e.target));
            if (!isClickInside && !sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.add('-translate-x-full');
            }
        }
    });

    window.addEventListener('resize', () => {
        if (window.innerWidth >= 1024) {
            sidebar.classList.remove('-translate-x-full');
            if (!isCollapsed) mainContent.classList.add('ml-64');
        } else {
            mainContent.classList.remove('ml-64', 'ml-20');
        }
    });

    // Close dropdown outside click
    document.addEventListener('click', function (e) {
        const dropdown = document.getElementById('profile-dropdown');
        const btn = document.getElementById('profile-dropdown-btn');
        if (dropdown && btn && !btn.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.classList.add('hidden');
        }
    });

    // Logout
    document.getElementById('logout-btn')?.addEventListener('click', function () {
        if (confirm('Are you sure you want to logout?')) {
            localStorage.removeItem('adminAuth');
            sessionStorage.clear();
            window.location.href = '../login.html';
        }
    });

    // Highlight active page
    document.querySelectorAll('#sidebar a').forEach(link => {
        if (link.href === window.location.href) {
            link.classList.remove('hover:bg-orange-500');
            link.classList.add('bg-orange-600', 'font-semibold');
        }
    });
</script>

<script src="../assets/js/inventory.js"></script>
</body>
</html>