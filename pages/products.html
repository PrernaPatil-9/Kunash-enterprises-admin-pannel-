<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Kunash Enterprises Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .sidebar-collapsed { width: 5rem !important; }
        .sidebar-collapsed .sidebar-logo { width: 3rem !important; height: 3rem !important; }
        .sidebar-collapsed .sidebar-text { display: none; }
        .main-content { transition: margin-left 0.3s ease; }
        .table-container { overflow-x: auto; max-height: 70vh; }
        .img-thumb { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; }
        .modal-img { max-width: 300px; max-height: 300px; object-fit: contain; border-radius: 8px; }
        .sub-gallery img { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; margin: 4px; border: 1px solid #ddd; }
        .star { color: #fbbf24; }
        .pagination-btn { @apply px-3 py-1 rounded border border-gray-300 bg-white text-sm hover:bg-orange-50; }
        .pagination-btn.active { @apply bg-orange-600 text-white border-orange-600; }
        .pagination-btn:disabled { @apply opacity-50 cursor-not-allowed; }
        
        /* Overlay Styles */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .overlay-content {
            background-color: white;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            border-radius: 8px;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .overlay-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .overlay-body {
            padding: 1.5rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
        }
        
        .close-btn:hover {
            color: #374151;
        }
        
        /* Add/Edit Product Form Styles */
        .img-preview { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 2px dashed #ddd; }
        .sub-img-preview { width: 50px; height: 50px; object-fit: cover; border-radius: 6px; margin: 4px; border: 1px solid #ccc; position: relative; }
        .remove-img { position: absolute; top: -6px; right: -6px; background: red; color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .dynamic-field { display: none; }
        
        /* Status badges */
        .status-active { @apply bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs; }
        .status-inactive { @apply bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="flex h-screen">

        <!-- Sidebar -->
        <div id="sidebar" class="w-64 bg-gray-800 text-white transition-all duration-300 fixed inset-y-0 left-0 z-20 flex flex-col">
            <div class="p-4 flex items-center justify-between">
                <img src="../assets/images/logoo bg.png" alt="Kunash Logo"
                     class="w-[10rem] h-[4rem] object-contain transition-all duration-300 sidebar-logo">
                <button id="toggle-btn" class="text-white p-1 rounded hover:bg-gray-700">
                    <span class="material-icons text-xl">chevron_left</span>
                </button>
            </div>
            <nav class="mt-4 space-y-1 flex-1 px-2">
                <a href="../index.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                    <span class="material-icons mr-3">dashboard</span><span class="sidebar-text">Dashboard</span></a>
                <a href="products.html" class="flex items-center py-2 px-3 bg-orange-600 font-semibold hover:bg-orange-500 rounded-lg transition">
                    <span class="material-icons mr-3">inventory_2</span><span class="sidebar-text">Products</span></a>
                <a href="inventory.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                    <span class="material-icons mr-3">warehouse</span><span class="sidebar-text">Inventory</span></a>
                <a href="orders.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                    <span class="material-icons mr-3">shopping_cart</span><span class="sidebar-text">Orders</span></a>
                <a href="customers.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                    <span class="material-icons mr-3">people</span><span class="sidebar-text">Customers</span></a>
                <a href="banners.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                    <span class="material-icons mr-3">image</span><span class="sidebar-text">Banners</span></a>
                <a href="messages.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                    <span class="material-icons mr-3">mail</span><span class="sidebar-text">Messages</span></a>
                <a href="discounts.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                    <span class="material-icons mr-3">local_offer</span><span class="sidebar-text">Discount Management</span></a>
                <a href="admins.html" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition">
                    <span class="material-icons mr-3">admin_panel_settings</span><span class="sidebar-text">Admin Management</span></a>
                <a href="../login.html" id="logout-btn" class="flex items-center py-2 px-3 hover:bg-orange-500 rounded-lg transition mt-4">
                    <span class="material-icons mr-3">logout</span><span class="sidebar-text">Logout</span></a>
            </nav>
        </div>

        <!-- ==================== MAIN CONTENT ==================== -->
        <div class="flex-1 flex flex-col overflow-hidden main-content ml-64 transition-all duration-300">
           <!-- Header -->
            <header class="bg-white shadow-md sticky top-0 z-50">
                <div class="flex justify-between items-center p-4 container mx-auto">
                    <div class="flex items-center space-x-4">
                        <button id="sidebar-toggle" class="text-gray-600 hover:text-orange-600 focus:outline-none lg:hidden">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                        <h2 class="text-xl font-semibold text-orange-600">Kunash Enterprises Admin</h2>
                    </div>
                    <div class="relative">
                        <button id="profile-dropdown-btn" class="flex items-center space-x-3 text-gray-700 hover:text-orange-600 focus:outline-none transition">
                            <div class="text-right hidden sm:block">
                                <p class="text-sm font-medium">Welcome, Admin</p>
                                <p class="text-xs text-gray-500">admin@kunash.com</p>
                            </div>
                            <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-md">A</div>
                            <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div id="profile-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 hidden z-50 animate-fadeIn">
                            <div class="px-4 py-2 border-b border-gray-100">
                                <p class="text-sm font-semibold text-gray-800">Admin User</p>
                                <p class="text-xs text-gray-500">admin@kunash.com</p>
                            </div>
                            <a href="/pages/profile.html" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition">
                                <span class="material-icons text-lg mr-2">person</span> My Profile
                            </a>
                            <hr class="my-1 border-gray-200">
                            <a href="login.html" id="logout-btn" class="w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition font-medium">
                                <span class="material-icons text-lg mr-2">logout</span> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </header>
            <!-- Products Content -->
            <main class="flex-1 overflow-y-auto p-6 container mx-auto">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <h2 class="text-3xl font-bold text-orange-600">Products</h2>

                    <div class="flex flex-wrap gap-2">
                        <label class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 transition cursor-pointer">
                            <input type="file" id="bulk-upload" accept=".csv,.xlsx" class="hidden"> Bulk Upload
                        </label>
                        <button id="bulk-delete" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 transition cursor-pointer" disabled>
                            Delete
                        </button>
                        <button id="export-csv" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 transition cursor-pointer">
                            Export CSV
                        </button>
                        <button id="export-excel" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 transition cursor-pointer">
                            Export Excel
                        </button>
                        <button id="add-product-btn" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 transition">Add Product</button>
                        <button id="add-category-btn" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 transition">Add Category</button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="bg-white p-4 rounded-lg shadow mb-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="filter-name" placeholder="Search by name..." class="px-3 py-2 border rounded-md focus:ring-orange-500 focus:border-orange-500">
                    <select id="filter-category" class="px-3 py-2 border rounded-md focus:ring-orange-500 focus:border-orange-500">
                        <option value="">All Categories</option>
                    </select>
                    <select id="filter-subcategory" class="px-3 py-2 border rounded-md focus:ring-orange-500 focus:border-orange-500">
                        <option value="">All Subcategories</option>
                    </select>
                    <div class="flex gap-2">
                        <input type="number" id="filter-min-price" placeholder="Min Price" class="w-full px-3 py-2 border rounded-md">
                        <input type="number" id="filter-max-price" placeholder="Max Price" class="w-full px-3 py-2 border rounded-md">
                    </div>
                </div>

                <!-- Reset & Pagination Info -->
                <div class="flex justify-between items-center mb-4">
                    <button id="reset-filters" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 transition">
                        Reset Filters
                    </button>
                    <p id="pagination-info" class="text-sm text-gray-600">Showing <span id="current-items">0</span> of <span id="total-items">0</span> products</p>
                </div>

                <!-- Products Table -->
                <div class="bg-white shadow rounded-lg overflow-hidden">
                    <div class="table-container">
                        <table id="products-table" class="w-full min-w-max">
                            <thead class="bg-orange-100 sticky top-0">
                                <tr>
                                    <th class="py-3 px-2 text-left text-sm font-medium text-gray-700">
                                        <input type="checkbox" id="select-all">
                                    </th>
                                    <th class="py-3 px-4 text-left text-sm font-medium text-gray-700">ID</th>
                                    <th class="py-3 px-4 text-left text-sm font-medium text-gray-700">Name</th>
                                    <th class="py-3 px-4 text-left text-sm font-medium text-gray-700">Main Image</th>
                                    <th class="py-3 px-4 text-left text-sm font-medium text-gray-700">Category</th>
                                    <th class="py-3 px-4 text-left text-sm font-medium text-gray-700">Subcategory</th>
                                    <th class="py-3 px-4 text-left text-sm font-medium text-gray-700">Price</th>
                                    <th class="py-3 px-4 text-left text-sm font-medium text-gray-700">Offer Price</th>
                                    <th class="py-3 px-4 text-left text-sm font-medium text-gray-700">Stock</th>
                                    <th class="py-3 px-4 text-left text-sm font-medium text-gray-700">Status</th>
                                    <th class="py-3 px-4 text-left text-sm font-medium text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="products-table-body">
                                <!-- Products will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination Controls -->
                    <div class="flex justify-center items-center space-x-2 p-4 border-t">
                        <button id="prev-page" class="pagination-btn" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div id="page-numbers" class="flex space-x-1"></div>
                        <button id="next-page" class="pagination-btn">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ==================== VIEW PRODUCT MODAL ==================== -->
    <div id="view-product-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-orange-600">Product Details</h3>
                <button id="close-view-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="view-product-content" class="space-y-6">
                <!-- Filled by JS -->
            </div>
        </div>
    </div>

    <!-- ==================== ADD CATEGORY MODAL ==================== -->
    <div id="add-category-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-orange-600">Add New Category</h3>
                <button id="close-category-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="add-category-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Category Name <span class="text-red-500">*</span></label>
                    <input type="text" id="category-name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Category Code</label>
                    <input type="text" id="category-code" placeholder="e.g., CAT001" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="category-desc" rows="3" placeholder="Short description..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Parent Category</label>
                    <select id="parent-category" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                        <option value="">None (Top Level)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Category Image</label>
                    <input type="file" id="category-image" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Display Order</label>
                    <input type="number" id="display-order" min="1" value="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Status <span class="text-red-500">*</span></label>
                    <select id="category-status" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" id="cancel-category" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 transition">Save Category</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== ADD PRODUCT OVERLAY ==================== -->
    <div id="add-product-overlay" class="overlay">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2 class="text-2xl font-bold text-orange-600">Add New Product</h2>
                <button class="close-btn" id="close-product-overlay">&times;</button>
            </div>
            <div class="overlay-body">
                <form id="add-product-form" class="space-y-6">
                    <!-- Product Name -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Product Name <span class="text-red-500">*</span></label>
                        <input type="text" id="add-name" required class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    </div>

                    <!-- Category & Subcategory -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Category <span class="text-red-500">*</span></label>
                            <select id="add-category" required class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                <option value="">Select Category</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Subcategory</label>
                            <select id="add-subcategory" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                <option value="">Select Subcategory (Optional)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Prices -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Price (₹) <span class="text-red-500">*</span> </label>
                            <input type="number" id="add-oldPrice" min="0" step="0.01" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Offer Price (₹) </label>
                            <input type="number" id="add-newPrice" required min="0" step="0.01" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>

                    <!-- Stock -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Stock Quantity <span class="text-red-500">*</span></label>
                        <input type="number" id="add-stock" required min="0" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    </div>

                    <!-- Dynamic Fields (RAM) -->
                    <div id="add-ram-field" class="dynamic-field">
                        <label class="block text-gray-700 font-medium mb-1">RAM</label>
                        <select id="add-ram" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            <option value="">Select RAM</option>
                            <option value="4GB">4GB</option>
                            <option value="8GB">8GB</option>
                            <option value="16GB">16GB</option>
                            <option value="32GB">32GB</option>
                        </select>
                    </div>

                    <!-- Main Image -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Main Image <span class="text-red-500">*</span></label>
                        <input type="file" id="add-mainImage" accept="image/*" required class="w-full border p-2 rounded">
                        <div id="add-mainImagePreview" class="mt-2"></div>
                    </div>

                    <!-- Sub Images -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Sub Images (Optional)</label>
                        <input type="file" id="add-subImages" accept="image/*" multiple class="w-full border p-2 rounded">
                        <div id="add-subImagesPreview" class="flex flex-wrap mt-2"></div>
                    </div>

                    <!-- Submit -->
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="bg-orange-600 text-white px-6 py-3 rounded hover:bg-orange-700 transition font-medium">
                            Add Product
                        </button>
                        <button type="button" id="cancel-add-product" class="bg-gray-500 text-white px-6 py-3 rounded hover:bg-gray-600 transition font-medium">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ==================== EDIT PRODUCT OVERLAY ==================== -->
    <div id="edit-product-overlay" class="overlay">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2 class="text-2xl font-bold text-orange-600">Edit Product</h2>
                <button class="close-btn" id="close-edit-product-overlay">&times;</button>
            </div>
            <div class="overlay-body">
                <form id="edit-product-form" class="space-y-6">
                    <!-- Product Name -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Product Name <span class="text-red-500">*</span></label>
                        <input type="text" id="edit-name" required class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    </div>

                    <!-- Category & Subcategory -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Category <span class="text-red-500">*</span></label>
                            <select id="edit-category" required class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                <option value="">Select Category</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Subcategory</label>
                            <select id="edit-subcategory" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                <option value="">Select Subcategory (Optional)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Prices -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Price (₹) <span class="text-red-500">*</span> </label>
                            <input type="number" id="edit-oldPrice" min="0" step="0.01" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Offer Price (₹) </label>
                            <input type="number" id="edit-newPrice" required min="0" step="0.01" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>

                    <!-- Stock -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Stock Quantity <span class="text-red-500">*</span></label>
                        <input type="number" id="edit-stock" required min="0" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    </div>

                    <!-- Dynamic Fields (RAM) -->
                    <div id="edit-ram-field" class="dynamic-field">
                        <label class="block text-gray-700 font-medium mb-1">RAM</label>
                        <select id="edit-ram" class="w-full border p-3 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            <option value="">Select RAM</option>
                            <option value="4GB">4GB</option>
                            <option value="8GB">8GB</option>
                            <option value="16GB">16GB</option>
                            <option value="32GB">32GB</option>
                        </select>
                    </div>

                    <!-- Main Image -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Main Image <span class="text-red-500">*</span></label>
                        <input type="file" id="edit-mainImage" accept="image/*" class="w-full border p-2 rounded">
                        <div id="edit-mainImagePreview" class="mt-2"></div>
                    </div>

                    <!-- Sub Images -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-1">Sub Images (Optional)</label>
                        <input type="file" id="edit-subImages" accept="image/*" multiple class="w-full border p-2 rounded">
                        <div id="edit-subImagesPreview" class="flex flex-wrap mt-2"></div>
                    </div>

                    <!-- Submit -->
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="bg-orange-600 text-white px-6 py-3 rounded hover:bg-orange-700 transition font-medium">
                            Save Changes
                        </button>
                        <button type="button" id="cancel-edit-product" class="bg-gray-500 text-white px-6 py-3 rounded hover:bg-gray-600 transition font-medium">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ==================== SCRIPTS ==================== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script>
        // ==================== GLOBAL VARIABLES ====================
        let products = JSON.parse(localStorage.getItem('products') || '[]');
        let categories = JSON.parse(localStorage.getItem('categories') || '[]');
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentEditProduct = null;
        let existingSubImages = [];

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Initialize sample data if empty
            initializeSampleData();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load initial data
            loadProductsTable();
            populateCategoryFilters();
        }

        function initializeSampleData() {
            // Sample categories
            if (categories.length === 0) {
                categories = [
                    { id: 'CAT001', name: 'Laptops', code: 'LAP', parent: '', status: 'active', needsRam: true },
                    { id: 'CAT002', name: 'Keyboards', code: 'KEYB', parent: '', status: 'active', needsRam: false },
                    { id: 'CAT003', name: 'Mouse', code: 'MSE', parent: '', status: 'active', needsRam: false },
                    { id: 'CAT004', name: 'Accessories', code: 'ACC', parent: '', status: 'active', needsRam: false },
                    { id: 'CAT005', name: 'Gaming Laptops', code: 'GAM_LAP', parent: 'Laptops', status: 'active', needsRam: true },
                    { id: 'CAT006', name: 'Business Laptops', code: 'BUS_LAP', parent: 'Laptops', status: 'active', needsRam: true }
                ];
                localStorage.setItem('categories', JSON.stringify(categories));
            }

            // Sample products
            if (products.length === 0) {
                products = [
                    {
                        id: 'PROD001',
                        name: 'Gaming Laptop Pro',
                        category: 'Laptops',
                        subcategory: 'Gaming Laptops',
                        oldPrice: 89999,
                        newPrice: 79999,
                        stock: 15,
                        mainImage: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjNmMyIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM5OTk5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5Qcm9kdWN0IEltYWdlPC90ZXh0Pjwvc3ZnPg==',
                        subImages: [],
                        ram: '16GB',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('products', JSON.stringify(products));
            }
        }

        function setupEventListeners() {
            // Sidebar and profile
            setupSidebarAndProfile();
            
            // Product overlays
            setupAddProductOverlay();
            setupEditProductOverlay();
            
            // Category modal
            setupCategoryModal();
            
            // Filters and pagination
            setupFiltersAndPagination();
        }

        // ==================== SIDEBAR AND PROFILE ====================
        function setupSidebarAndProfile() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            const toggleBtn = document.getElementById('toggle-btn');
            const toggleIcon = toggleBtn?.querySelector('.material-icons');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            let isCollapsed = false;

            if (toggleBtn && toggleIcon) {
                toggleBtn.addEventListener('click', () => {
                    isCollapsed = !isCollapsed;
                    sidebar.classList.toggle('sidebar-collapsed', isCollapsed);
                    mainContent.classList.toggle('ml-64', !isCollapsed);
                    mainContent.classList.toggle('ml-20', isCollapsed);
                    toggleIcon.textContent = isCollapsed ? 'chevron_right' : 'chevron_left';
                });
            }

            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('-translate-x-full');
                });
            }

            // Profile dropdown
            const profileDropdownBtn = document.getElementById('profile-dropdown-btn');
            const profileDropdown = document.getElementById('profile-dropdown');
            
            if (profileDropdownBtn && profileDropdown) {
                profileDropdownBtn.addEventListener('click', () => {
                    profileDropdown.classList.toggle('hidden');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!profileDropdownBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
                        profileDropdown.classList.add('hidden');
                    }
                });
            }

            // Logout
            const logoutBtns = document.querySelectorAll('#logout-btn');
            logoutBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (confirm('Are you sure you want to logout?')) {
                        localStorage.removeItem('adminAuth');
                        sessionStorage.clear();
                        window.location.href = '../login.html';
                    }
                });
            });
        }

        // ==================== ADD PRODUCT OVERLAY ====================
        function setupAddProductOverlay() {
            const overlay = document.getElementById('add-product-overlay');
            const addProductBtn = document.getElementById('add-product-btn');
            const closeOverlayBtn = document.getElementById('close-product-overlay');
            const cancelBtn = document.getElementById('cancel-add-product');
            const form = document.getElementById('add-product-form');
            const catSelect = document.getElementById('add-category');
            const subcatSelect = document.getElementById('add-subcategory');
            const mainImgInput = document.getElementById('add-mainImage');
            const subImgInput = document.getElementById('add-subImages');
            const mainPreview = document.getElementById('add-mainImagePreview');
            const subPreview = document.getElementById('add-subImagesPreview');
            const ramField = document.getElementById('add-ram-field');

            // Show overlay
            addProductBtn.addEventListener('click', () => {
                overlay.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                populateAddCategories();
            });

            // Hide overlay
            function hideAddProductOverlay() {
                overlay.style.display = 'none';
                document.body.style.overflow = 'auto';
                resetAddProductForm();
            }

            closeOverlayBtn.addEventListener('click', hideAddProductOverlay);
            cancelBtn.addEventListener('click', hideAddProductOverlay);

            // Close on outside click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) hideAddProductOverlay();
            });

            // Category change
            catSelect.addEventListener('change', function() {
                const selected = this.value;
                subcatSelect.innerHTML = '<option value="">Select Subcategory (Optional)</option>';
                
                // Show/hide RAM field
                const selectedCategory = categories.find(c => c.name === selected);
                ramField.style.display = selectedCategory?.needsRam ? 'block' : 'none';
                
                if (selected) {
                    const parentCat = categories.find(c => c.name === selected);
                    if (parentCat) {
                        categories.filter(c => c.parent === selected && c.status === 'active').forEach(c => {
                            const opt = new Option(`${c.name} (${c.code})`, c.name);
                            subcatSelect.appendChild(opt);
                        });
                    }
                }
            });

            // Image previews
            mainImgInput.addEventListener('change', handleAddMainImagePreview);
            subImgInput.addEventListener('change', handleAddSubImagesPreview);

            // Form submission
            form.addEventListener('submit', handleAddProductSubmit);
        }

        function populateAddCategories() {
            const catSelect = document.getElementById('add-category');
            catSelect.innerHTML = '<option value="">Select Category</option>';
            categories.filter(c => c.status === 'active' && !c.parent).forEach(c => {
                const opt = new Option(`${c.name} (${c.code})`, c.name);
                catSelect.appendChild(opt);
            });
        }

        function handleAddMainImagePreview() {
            const file = this.files[0];
            const preview = document.getElementById('add-mainImagePreview');
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.innerHTML = `<img src="${e.target.result}" class="img-preview">`;
            };
            reader.readAsDataURL(file);
        }

        function handleAddSubImagesPreview() {
            const files = Array.from(this.files);
            const preview = document.getElementById('add-subImagesPreview');
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'relative';
                    wrapper.innerHTML = `
                        <img src="${e.target.result}" class="sub-img-preview">
                        <div class="remove-img" onclick="this.parentElement.remove()">×</div>
                    `;
                    preview.appendChild(wrapper);
                };
                reader.readAsDataURL(file);
            });
        }

        function resetAddProductForm() {
            const form = document.getElementById('add-product-form');
            form.reset();
            document.getElementById('add-mainImagePreview').innerHTML = '';
            document.getElementById('add-subImagesPreview').innerHTML = '';
            document.getElementById('add-ram-field').style.display = 'none';
            document.getElementById('add-subcategory').innerHTML = '<option value="">Select Subcategory (Optional)</option>';
        }

        function handleAddProductSubmit(e) {
            e.preventDefault();
            
            const mainFile = document.getElementById('add-mainImage').files[0];
            
            if (!mainFile) {
                alert('Main image is required!');
                return;
            }

            // Convert main image to base64
            const reader = new FileReader();
            reader.onload = () => {
                const mainImage = reader.result;
                
                // Convert sub images to base64
                const subFiles = Array.from(document.getElementById('add-subImages').files);
                const subImagesPromises = subFiles.map(file => {
                    return new Promise(resolve => {
                        const subReader = new FileReader();
                        subReader.onload = (e) => resolve(e.target.result);
                        subReader.readAsDataURL(file);
                    });
                });

                Promise.all(subImagesPromises).then(subImages => {
                    const newProduct = {
                        id: generateProductId(),
                        name: document.getElementById('add-name').value.trim(),
                        category: document.getElementById('add-category').value,
                        subcategory: document.getElementById('add-subcategory').value || '',
                        oldPrice: parseFloat(document.getElementById('add-oldPrice').value) || 0,
                        newPrice: parseFloat(document.getElementById('add-newPrice').value),
                        stock: parseInt(document.getElementById('add-stock').value),
                        mainImage: mainImage,
                        subImages: subImages,
                        ram: document.getElementById('add-ram').value,
                        status: 'active',
                        createdAt: new Date().toISOString()
                    };

                    if (!newProduct.name || !newProduct.category || isNaN(newProduct.newPrice) || isNaN(newProduct.stock)) {
                        alert('Please fill all required fields correctly.');
                        return;
                    }

                    products.push(newProduct);
                    localStorage.setItem('products', JSON.stringify(products));
                    
                    alert('Product added successfully!');
                    
                    // Hide overlay and reset form
                    document.getElementById('add-product-overlay').style.display = 'none';
                    document.body.style.overflow = 'auto';
                    resetAddProductForm();
                    
                    // Refresh the products table
                    loadProductsTable();
                });
            };
            
            reader.readAsDataURL(mainFile);
        }

        // ==================== EDIT PRODUCT OVERLAY ====================
        function setupEditProductOverlay() {
            const overlay = document.getElementById('edit-product-overlay');
            const closeOverlayBtn = document.getElementById('close-edit-product-overlay');
            const cancelBtn = document.getElementById('cancel-edit-product');
            const form = document.getElementById('edit-product-form');
            const catSelect = document.getElementById('edit-category');
            const subcatSelect = document.getElementById('edit-subcategory');
            const mainImgInput = document.getElementById('edit-mainImage');
            const subImgInput = document.getElementById('edit-subImages');
            const mainPreview = document.getElementById('edit-mainImagePreview');
            const subPreview = document.getElementById('edit-subImagesPreview');
            const ramField = document.getElementById('edit-ram-field');

            // Hide overlay
            function hideEditProductOverlay() {
                overlay.style.display = 'none';
                document.body.style.overflow = 'auto';
                resetEditProductForm();
            }

            closeOverlayBtn.addEventListener('click', hideEditProductOverlay);
            cancelBtn.addEventListener('click', hideEditProductOverlay);

            // Close on outside click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) hideEditProductOverlay();
            });

            // Category change
            catSelect.addEventListener('change', function() {
                const selected = this.value;
                subcatSelect.innerHTML = '<option value="">Select Subcategory (Optional)</option>';
                
                // Show/hide RAM field
                const selectedCategory = categories.find(c => c.name === selected);
                ramField.style.display = selectedCategory?.needsRam ? 'block' : 'none';
                
                if (selected) {
                    const parentCat = categories.find(c => c.name === selected);
                    if (parentCat) {
                        categories.filter(c => c.parent === selected && c.status === 'active').forEach(c => {
                            const opt = new Option(`${c.name} (${c.code})`, c.name);
                            subcatSelect.appendChild(opt);
                        });
                    }
                }
            });

            // Image previews
            mainImgInput.addEventListener('change', handleEditMainImagePreview);
            subImgInput.addEventListener('change', handleEditSubImagesPreview);

            // Form submission
            form.addEventListener('submit', handleEditProductSubmit);
        }

        function openEditProductOverlay(productId) {
            currentEditProduct = products.find(p => p.id === productId);
            if (!currentEditProduct) {
                alert('Product not found!');
                return;
            }

            // Populate form fields
            document.getElementById('edit-name').value = currentEditProduct.name || '';
            document.getElementById('edit-oldPrice').value = currentEditProduct.oldPrice || '';
            document.getElementById('edit-newPrice').value = currentEditProduct.newPrice || '';
            document.getElementById('edit-stock').value = currentEditProduct.stock || '';
            document.getElementById('edit-ram').value = currentEditProduct.ram || '';

            // Load images
            if (currentEditProduct.mainImage) {
                document.getElementById('edit-mainImagePreview').innerHTML = `<img src="${currentEditProduct.mainImage}" class="img-preview">`;
            }

            if (currentEditProduct.subImages && currentEditProduct.subImages.length > 0) {
                existingSubImages = [...currentEditProduct.subImages];
                const subPreview = document.getElementById('edit-subImagesPreview');
                subPreview.innerHTML = '';
                currentEditProduct.subImages.forEach((img, i) => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'relative';
                    wrapper.innerHTML = `
                        <img src="${img}" class="sub-img-preview">
                        <div class="remove-img" data-index="${i}">×</div>
                    `;
                    subPreview.appendChild(wrapper);
                });
            }

            // Populate categories and set values
            populateEditCategories();
            document.getElementById('edit-category').value = currentEditProduct.category || '';
            populateEditSubcategories(currentEditProduct.category);
            document.getElementById('edit-subcategory').value = currentEditProduct.subcategory || '';
            
            // Toggle RAM field based on category
            const selectedCategory = categories.find(c => c.name === currentEditProduct.category);
            document.getElementById('edit-ram-field').style.display = selectedCategory?.needsRam ? 'block' : 'none';

            // Show overlay
            document.getElementById('edit-product-overlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function populateEditCategories() {
            const catSelect = document.getElementById('edit-category');
            catSelect.innerHTML = '<option value="">Select Category</option>';
            categories.filter(c => c.status === 'active' && !c.parent).forEach(c => {
                const opt = new Option(`${c.name} (${c.code})`, c.name);
                catSelect.appendChild(opt);
            });
        }

        function populateEditSubcategories(selectedCategory = '') {
            const subcatSelect = document.getElementById('edit-subcategory');
            subcatSelect.innerHTML = '<option value="">Select Subcategory (Optional)</option>';
            if (!selectedCategory) return;

            const parentCat = categories.find(c => c.name === selectedCategory);
            if (!parentCat) return;

            categories.filter(c => c.parent === selectedCategory && c.status === 'active').forEach(c => {
                const opt = new Option(`${c.name} (${c.code})`, c.name);
                subcatSelect.appendChild(opt);
            });
        }

        function handleEditMainImagePreview() {
            const file = this.files[0];
            const preview = document.getElementById('edit-mainImagePreview');
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.innerHTML = `<img src="${e.target.result}" class="img-preview">`;
            };
            reader.readAsDataURL(file);
        }

        function handleEditSubImagesPreview() {
            const files = Array.from(this.files);
            const preview = document.getElementById('edit-subImagesPreview');
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'relative';
                    wrapper.innerHTML = `
                        <img src="${e.target.result}" class="sub-img-preview">
                        <div class="remove-img" onclick="this.parentElement.remove()">×</div>
                    `;
                    preview.appendChild(wrapper);
                };
                reader.readAsDataURL(file);
            });
        }

        // Remove sub image from preview
        document.getElementById('edit-subImagesPreview').addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-img')) {
                const index = e.target.getAttribute('data-index');
                if (index !== null) {
                    existingSubImages.splice(index, 1);
                }
                e.target.parentElement.remove();
            }
        });

        function resetEditProductForm() {
            const form = document.getElementById('edit-product-form');
            form.reset();
            document.getElementById('edit-mainImagePreview').innerHTML = '';
            document.getElementById('edit-subImagesPreview').innerHTML = '';
            document.getElementById('edit-ram-field').style.display = 'none';
            document.getElementById('edit-subcategory').innerHTML = '<option value="">Select Subcategory (Optional)</option>';
            currentEditProduct = null;
            existingSubImages = [];
        }

        function handleEditProductSubmit(e) {
            e.preventDefault();

            const mainFile = document.getElementById('edit-mainImage').files[0];
            const newMainImage = mainFile ? fileToBase64(mainFile) : currentEditProduct.mainImage;

            // Collect all sub images (existing + new)
            const allSubImages = [...existingSubImages];
            
            // Add new uploaded images
            const newFiles = Array.from(document.getElementById('edit-subImages').files);
            const subImagesPromises = newFiles.map(file => fileToBase64(file));

            Promise.all(subImagesPromises).then(newSubImages => {
                allSubImages.push(...newSubImages);

                const updatedProduct = {
                    ...currentEditProduct,
                    name: document.getElementById('edit-name').value.trim(),
                    category: document.getElementById('edit-category').value,
                    subcategory: document.getElementById('edit-subcategory').value || '',
                    oldPrice: parseFloat(document.getElementById('edit-oldPrice').value) || 0,
                    newPrice: parseFloat(document.getElementById('edit-newPrice').value),
                    stock: parseInt(document.getElementById('edit-stock').value),
                    mainImage: newMainImage,
                    subImages: allSubImages,
                    ram: document.getElementById('edit-ram').value,
                    updatedAt: new Date().toISOString()
                };

                if (!updatedProduct.name || !updatedProduct.category || isNaN(updatedProduct.newPrice) || isNaN(updatedProduct.stock)) {
                    alert('Please fill all required fields correctly.');
                    return;
                }

                const index = products.findIndex(p => p.id === currentEditProduct.id);
                if (index !== -1) {
                    products[index] = updatedProduct;
                    localStorage.setItem('products', JSON.stringify(products));
                    alert('Product updated successfully!');
                    
                    // Hide overlay and reset form
                    document.getElementById('edit-product-overlay').style.display = 'none';
                    document.body.style.overflow = 'auto';
                    resetEditProductForm();
                    
                    // Refresh the products table
                    loadProductsTable();
                }
            });
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function generateProductId() {
            const max = products.reduce((m, p) => Math.max(m, parseInt(p.id.replace('PROD', '')) || 0), 0);
            return 'PROD' + String(max + 1).padStart(3, '0');
        }

        // ==================== CATEGORY MODAL ====================
        function setupCategoryModal() {
            const modal = document.getElementById('add-category-modal');
            const addBtn = document.getElementById('add-category-btn');
            const closeBtn = document.getElementById('close-category-modal');
            const cancelBtn = document.getElementById('cancel-category');
            const form = document.getElementById('add-category-form');

            // Show modal
            addBtn.addEventListener('click', () => {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });

            // Hide modal
            function hideCategoryModal() {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }

            closeBtn.addEventListener('click', hideCategoryModal);
            cancelBtn.addEventListener('click', hideCategoryModal);

            // Close on outside click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) hideCategoryModal();
            });

            // Form submission
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const categoryData = {
                    id: 'CAT' + String(categories.length + 1).padStart(3, '0'),
                    name: document.getElementById('category-name').value,
                    code: document.getElementById('category-code').value,
                    description: document.getElementById('category-desc').value,
                    parent: document.getElementById('parent-category').value,
                    status: document.getElementById('category-status').value,
                    displayOrder: parseInt(document.getElementById('display-order').value)
                };
                
                categories.push(categoryData);
                localStorage.setItem('categories', JSON.stringify(categories));
                
                alert('Category added successfully!');
                hideCategoryModal();
                form.reset();
                
                // Refresh category filters
                populateCategoryFilters();
            });
        }

        // ==================== PRODUCTS TABLE ====================
        function loadProductsTable() {
            const tableBody = document.getElementById('products-table-body');
            tableBody.innerHTML = '';

            if (products.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="11" class="py-4 text-center text-gray-500">
                            No products found. Click "Add Product" to create your first product.
                        </td>
                    </tr>
                `;
                updatePaginationInfo();
                return;
            }

            // Apply filters
            const filteredProducts = filterProducts(products);
            
            // Apply pagination
            const paginatedProducts = paginateProducts(filteredProducts);
            
            // Render products
            paginatedProducts.forEach(product => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="py-3 px-2">
                        <input type="checkbox" class="product-checkbox" value="${product.id}">
                    </td>
                    <td class="py-3 px-4">${product.id}</td>
                    <td class="py-3 px-4 font-medium">${product.name}</td>
                    <td class="py-3 px-4">
                        <img src="${product.mainImage}" alt="${product.name}" class="img-thumb">
                    </td>
                    <td class="py-3 px-4">${product.category}</td>
                    <td class="py-3 px-4">${product.subcategory || '-'}</td>
                    <td class="py-3 px-4">₹${product.oldPrice.toLocaleString()}</td>
                    <td class="py-3 px-4 font-semibold text-orange-600">₹${product.newPrice.toLocaleString()}</td>
                    <td class="py-3 px-4">${product.stock}</td>
                    <td class="py-3 px-4">
                        <span class="${product.status === 'active' ? 'status-active' : 'status-inactive'}">
                            ${product.status}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button class="text-blue-600 hover:text-blue-800 view-product" data-id="${product.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="text-green-600 hover:text-green-800 edit-product" data-id="${product.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800 delete-product" data-id="${product.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Add event listeners to action buttons
            addProductActionListeners();
            
            // Update pagination
            updatePaginationInfo();
            setupPagination(filteredProducts.length);
        }

        function filterProducts(productsList) {
            const nameFilter = document.getElementById('filter-name').value.toLowerCase();
            const categoryFilter = document.getElementById('filter-category').value;
            const subcategoryFilter = document.getElementById('filter-subcategory').value;
            const minPrice = parseFloat(document.getElementById('filter-min-price').value) || 0;
            const maxPrice = parseFloat(document.getElementById('filter-max-price').value) || Infinity;

            return productsList.filter(product => {
                return (
                    product.name.toLowerCase().includes(nameFilter) &&
                    (categoryFilter === '' || product.category === categoryFilter) &&
                    (subcategoryFilter === '' || product.subcategory === subcategoryFilter) &&
                    product.newPrice >= minPrice &&
                    product.newPrice <= maxPrice
                );
            });
        }

        function paginateProducts(productsList) {
            const startIndex = (currentPage - 1) * itemsPerPage;
            return productsList.slice(startIndex, startIndex + itemsPerPage);
        }

        function addProductActionListeners() {
            // View product
            document.querySelectorAll('.view-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    viewProduct(productId);
                });
            });

            // Edit product
            document.querySelectorAll('.edit-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    openEditProductOverlay(productId);
                });
            });

            // Delete product
            document.querySelectorAll('.delete-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    deleteProduct(productId);
                });
            });
        }

        function viewProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const modal = document.getElementById('view-product-modal');
            const content = document.getElementById('view-product-content');
            
            content.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <img src="${product.mainImage}" alt="${product.name}" class="modal-img w-full">
                        ${product.subImages.length > 0 ? `
                            <div class="sub-gallery flex flex-wrap mt-4">
                                ${product.subImages.map(img => `<img src="${img}" alt="Sub Image">`).join('')}
                            </div>
                        ` : ''}
                    </div>
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-gray-700">Product Name</h4>
                            <p class="text-lg">${product.name}</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700">Product ID</h4>
                            <p>${product.id}</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-gray-700">Category</h4>
                                <p>${product.category}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700">Subcategory</h4>
                                <p>${product.subcategory || '-'}</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-gray-700">Price</h4>
                                <p class="text-gray-500 line-through">₹${product.oldPrice.toLocaleString()}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700">Offer Price</h4>
                                <p class="text-orange-600 font-semibold">₹${product.newPrice.toLocaleString()}</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-gray-700">Stock</h4>
                                <p>${product.stock}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700">Status</h4>
                                <span class="${product.status === 'active' ? 'status-active' : 'status-inactive'}">
                                    ${product.status}
                                </span>
                            </div>
                        </div>
                        ${product.ram ? `
                            <div>
                                <h4 class="font-semibold text-gray-700">RAM</h4>
                                <p>${product.ram}</p>
                            </div>
                        ` : ''}
                        <div>
                            <h4 class="font-semibold text-gray-700">Created At</h4>
                            <p>${new Date(product.createdAt).toLocaleDateString()}</p>
                        </div>
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';

            // Close modal
            document.getElementById('close-view-modal').addEventListener('click', () => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            });

            // Close on outside click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }
            });
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                products = products.filter(p => p.id !== productId);
                localStorage.setItem('products', JSON.stringify(products));
                loadProductsTable();
                alert('Product deleted successfully!');
            }
        }

        // ==================== FILTERS AND PAGINATION ====================
        function setupFiltersAndPagination() {
            // Filter events
            const filterInputs = [
                'filter-name', 'filter-category', 'filter-subcategory', 
                'filter-min-price', 'filter-max-price'
            ];
            
            filterInputs.forEach(id => {
                document.getElementById(id).addEventListener('input', () => {
                    currentPage = 1;
                    loadProductsTable();
                });
            });

            // Reset filters
            document.getElementById('reset-filters').addEventListener('click', () => {
                document.getElementById('filter-name').value = '';
                document.getElementById('filter-category').value = '';
                document.getElementById('filter-subcategory').value = '';
                document.getElementById('filter-min-price').value = '';
                document.getElementById('filter-max-price').value = '';
                currentPage = 1;
                loadProductsTable();
            });

            // Pagination
            document.getElementById('prev-page').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadProductsTable();
                }
            });

            document.getElementById('next-page').addEventListener('click', () => {
                const filteredProducts = filterProducts(products);
                const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    loadProductsTable();
                }
            });
        }

        function populateCategoryFilters() {
            const categoryFilter = document.getElementById('filter-category');
            const subcategoryFilter = document.getElementById('filter-subcategory');
            const parentCategory = document.getElementById('parent-category');

            // Clear existing options
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            subcategoryFilter.innerHTML = '<option value="">All Subcategories</option>';
            parentCategory.innerHTML = '<option value="">None (Top Level)</option>';

            // Add categories
            categories.filter(c => !c.parent).forEach(category => {
                const option = new Option(category.name, category.name);
                categoryFilter.appendChild(option);
                
                const parentOption = new Option(category.name, category.name);
                parentCategory.appendChild(parentOption);
            });

            // Add subcategories to parent category dropdown
            categories.filter(c => c.parent).forEach(subcategory => {
                const option = new Option(`${subcategory.name} (${subcategory.parent})`, subcategory.name);
                parentCategory.appendChild(option);
            });
        }

        function updatePaginationInfo() {
            const filteredProducts = filterProducts(products);
            const totalItems = filteredProducts.length;
            const startItem = (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(currentPage * itemsPerPage, totalItems);

            document.getElementById('current-items').textContent = 
                totalItems === 0 ? '0' : `${startItem}-${endItem}`;
            document.getElementById('total-items').textContent = totalItems;
        }

        function setupPagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const pageNumbers = document.getElementById('page-numbers');
            const prevBtn = document.getElementById('prev-page');
            const nextBtn = document.getElementById('next-page');

            // Update button states
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;

            // Generate page numbers
            pageNumbers.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                btn.textContent = i;
                btn.addEventListener('click', () => {
                    currentPage = i;
                    loadProductsTable();
                });
                pageNumbers.appendChild(btn);
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            if (!notification) return;

            notification.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg text-white ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            notification.textContent = message;
            notification.classList.remove('hidden');

            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>